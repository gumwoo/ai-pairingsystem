# AI 기반 설명 가능한 페어링 시스템 - 백엔드 아키텍처 개요

## 1. 기술 스택

- **백엔드 프레임워크**: Node.js + Express.js
- **데이터베이스**: MySQL
- **AI 모델 통합**: Python 스크립트 실행을 통한 FlavorDiffusion 모델 연동
- **API 문서화**: Swagger/OpenAPI
- **로깅 시스템**: Winston + 회전식 파일 로깅
- **인증/인가**: JWT 기반 사용자 인증
- **자연어 생성**: OpenAI API를 통한 페어링 설명 생성

## 2. 핵심 기능

### 2.1. 데이터베이스 구조
- **nodes**: 모든 노드 정보 저장 (주류, 재료, 화합물)
- **edges**: 노드 간 관계 저장 (주류-화합물, 재료-화합물 등)
- **liquors, ingredients, compounds**: 각 유형별 추가 정보
- **pairings**: 주류-재료 페어링 정보 저장
- **사용자 관련 테이블**: 사용자 정보, 선호도, 평가 등

### 2.2. AI 모델 통합
- **FlavorDiffusion**: 그래프 신경망(GNN) 기반 페어링 점수 예측 모델
- **Node.js와 Python 간 통신**: Child Process를 통한 모델 실행
- **페어링 점수 계산**: 주류와 재료 간 페어링 점수 예측 (0~1 사이 값)
- **추천 시스템**: 특정 주류에 맞는 재료 추천 기능
- **자연어 설명 생성**: OpenAI API를 활용한 페어링 설명 생성

### 2.3. API 엔드포인트
- **인증 API**: 회원가입, 로그인, 로그아웃, 사용자 정보 조회
- **주류/재료 API**: CRUD 작업, 검색, 카테고리별 조회
- **페어링 API**: 페어링 점수 예측, 페어링 정보 조회, 평가
- **추천 API**: 주류별 추천 재료, 개인 맞춤 추천, 인기 페어링
- **관리자 API**: 데이터 관리, 통계, 시스템 관리

## 3. 백엔드 아키텍처

### 3.1. 계층형 구조
- **라우터 (routes/)**: API 엔드포인트 정의
- **컨트롤러 (controllers/)**: 비즈니스 로직 처리
- **모델 (models/)**: 데이터베이스 접근 로직
- **미들웨어 (middleware/)**: 인증, 로깅, 오류 처리 등
- **유틸리티 (utils/)**: 공통 기능 함수
- **AI 통합 (ai/)**: AI 모델 연동 코드

### 3.2. 주요 컨트롤러
- **liquorController**: 주류 관련 API 처리
- **ingredientController**: 재료 관련 API 처리
- **pairingController**: 페어링 예측 및 조회
- **recommendationController**: 추천 알고리즘 및 API
- **userController**: 사용자 관리
- **preferenceController**: 사용자 선호도 관리

### 3.3. AI 모델 통합 모듈 (model.js)
- **getPairingScore()**: 주류-재료 페어링 점수 예측
- **getRecommendations()**: 특정 주류에 대한 재료 추천
- **getExplanation()**: 페어링에 대한 설명 생성
- **generateExplanationWithAI()**: OpenAI API 활용 설명 생성

## 4. MongoDB에서 MySQL로의 마이그레이션

### 4.1. 완료된 마이그레이션
- **모든 컨트롤러 코드 변경**: MongoDB 쿼리를 MySQL 호환 코드로 변경
- **모델 구조 재설계**: MySQL 친화적인 모델 구조로 변경
- **데이터 마이그레이션**: Hub_Nodes, Hub_Edges 등 핵심 데이터 이전 완료
- **API 검증**: 모든 API 엔드포인트 기능 검증 및 버그 수정

### 4.2. ERD 개선
- **그래프 데이터베이스 구조**: nodes, edges 테이블을 통한 그래프 구조 표현
- **관계형 데이터베이스 최적화**: 인덱싱, 외래 키 제약 조건 등 구현
- **스키마 최적화**: 필드 타입 조정, UNIQUE 제약 조건 추가 등

## 5. 로깅 및 오류 처리

### 5.1. 로깅 시스템
- **애플리케이션 로그**: 일반 작동 로그
- **오류 로그**: 예외 및 오류 정보
- **액세스 로그**: API 요청 및 응답 로그
- **로그 회전**: 일별/크기별 로그 파일 회전

### 5.2. 오류 처리
- **전역 오류 핸들러**: 모든 미처리 예외 포착
- **구조화된 오류 응답**: 일관된 형식의 오류 메시지
- **트랜잭션 관리**: 중요 작업에 대한 데이터베이스 트랜잭션 적용

## 6. 보안 및 성능

### 6.1. 보안 기능
- **JWT 인증**: JSON Web Token 기반 사용자 인증
- **비밀번호 해싱**: bcryptjs를 사용한 안전한 비밀번호 저장
- **CORS 설정**: Cross-Origin Resource Sharing 제어
- **헬멧 미들웨어**: HTTP 헤더 보안 설정

### 6.2. 성능 최적화
- **압축 미들웨어**: HTTP 응답 압축
- **캐싱 전략**: 자주 사용되는 데이터 메모리 캐싱
- **데이터베이스 인덱싱**: 주요 쿼리에 대한 인덱스 설정
- **비동기 처리**: 병렬 처리를 통한 응답 시간 최적화

## 7. API 문서화

### 7.1. Swagger/OpenAPI
- **API 명세**: 엔드포인트, 파라미터, 응답 형식 정의
- **인터랙티브 문서**: Swagger UI를 통한 API 테스트
- **스키마 정의**: 요청/응답 데이터 구조 명세

## 8. 배포 및 확장성

### 8.1. Docker 컨테이너화
- **마이크로서비스 아키텍처**: 각 서비스별 독립 컨테이너
- **환경 설정**: 개발/테스트/프로덕션 환경 분리
- **컨테이너 오케스트레이션**: Docker Compose를 통한 서비스 관리

### 8.2. 확장성 설계
- **수평적 확장**: 필요에 따라 서버 인스턴스 추가 가능
- **모듈식 구조**: 기능별 모듈 분리로 유지보수성 향상
- **API 버전 관리**: 안정적인 API 업데이트를 위한 버전 관리
